<aside
  class="w-80 blender-panel shrink-0 z-10 flex flex-col h-full overflow-hidden"
>
  <div class="blender-header select-none">
    <div class="flex items-center gap-3">
      <span class="text-base text-[var(--accent-primary)]">‚öôÔ∏è</span>
      <span class="tracking-widest">Properties</span>
    </div>
  </div>

  <div class="p-0 flex-1 overflow-y-auto custom-scrollbar bg-[var(--bg-panel)]">
    <!-- No Selection / Scene Settings -->
    <template x-if="selectedEntityIdx === -1">
      <div>
        <div class="prop-group">
          <div class="prop-group-header">SCENE SETTINGS</div>

          <div class="space-y-1 p-2">
            <div class="flex items-center gap-2">
              <label
                class="text-[10px] text-(--text-muted) w-20 text-right shrink-0"
                >ID</label
              >
              <input
                type="text"
                x-model="config.id"
                @input="markDirty()"
                class="blender-input font-mono text-[11px] w-full"
                :disabled="isBuiltInLevel(currentLevelId)"
                :class="isBuiltInLevel(currentLevelId) ? 'opacity-50' : ''"
              />
            </div>

            <div class="flex items-center gap-2">
              <label
                class="text-[10px] text-(--text-muted) w-20 text-right shrink-0"
                >Name</label
              >
              <input
                type="text"
                x-model="config.name"
                @input="markDirty()"
                class="blender-input w-full"
              />
            </div>

            <!-- BG Music -->
            <div class="flex items-center gap-2">
              <label
                class="text-[10px] text-(--text-muted) w-20 text-right shrink-0"
                >BG Music</label
              >
              <div class="flex-1 flex gap-1">
                <input
                  disabled
                  x-model="config.music"
                  placeholder="/assets/music/..."
                  class="blender-input w-full"
                />
                <button
                  @click="openAssetBrowser(null, 'music')"
                  class="px-2 bg-[var(--bg-input)] hover:bg-[var(--bg-input-hover)] border border-[var(--border-light)] rounded select-none text-[10px]"
                  >üéµ</button
                >
              </div>
            </div>
          </div>
        </div>

        <div class="prop-group mt-1">
          <div class="prop-group-header">ENVIRONMENT</div>

          <div class="space-y-1 p-2">
            <!-- Environment Scale -->
            <div class="flex items-center gap-2">
              <label
                class="text-[10px] text-(--text-muted) w-20 text-right shrink-0"
                >Scale</label
              >
              <input
                type="number"
                x-model.number="config.environment.scale"
                @input="reloadLevelPromise()"
                class="blender-input w-full"
                step="0.5"
              />
            </div>

            <!-- Environment Position -->
            <div class="flex items-center gap-2">
              <label
                class="text-[10px] text-(--text-muted) w-20 text-right shrink-0"
                >Position</label
              >
              <div class="grid grid-cols-3 gap-1 w-full">
                <div class="relative">
                  <div
                    class="absolute left-1 top-1/2 -translate-y-1/2 text-[8px] font-bold text-red-500 pointer-events-none"
                  >
                    X
                  </div>
                  <input
                    type="number"
                    step="0.5"
                    :value="config.environment.position ? config.environment.position[0] : 0"
                    @input="if(!config.environment.position) config.environment.position = [0,0,0]; config.environment.position[0] = parseFloat($event.target.value); reloadLevelPromise()"
                    class="blender-input w-full pl-3 text-center"
                  />
                </div>
                <div class="relative">
                  <div
                    class="absolute left-1 top-1/2 -translate-y-1/2 text-[8px] font-bold text-green-500 pointer-events-none"
                  >
                    Y
                  </div>
                  <input
                    type="number"
                    step="0.5"
                    :value="config.environment.position ? config.environment.position[1] : 0"
                    @input="if(!config.environment.position) config.environment.position = [0,0,0]; config.environment.position[1] = parseFloat($event.target.value); reloadLevelPromise()"
                    class="blender-input w-full pl-3 text-center"
                  />
                </div>
                <div class="relative">
                  <div
                    class="absolute left-1 top-1/2 -translate-y-1/2 text-[8px] font-bold text-blue-500 pointer-events-none"
                  >
                    Z
                  </div>
                  <input
                    type="number"
                    step="0.5"
                    :value="config.environment.position ? config.environment.position[2] : 0"
                    @input="if(!config.environment.position) config.environment.position = [0,0,0]; config.environment.position[2] = parseFloat($event.target.value); reloadLevelPromise()"
                    class="blender-input w-full pl-3 text-center"
                  />
                </div>
              </div>
            </div>

            <!-- Ambient -->
            <div class="flex items-center gap-2">
              <label
                class="text-[10px] text-(--text-muted) w-20 text-right shrink-0"
                >Ambient</label
              >
              <input
                type="number"
                x-model.number="config.ambientIntensity"
                @input="hotUpdate"
                class="blender-input w-full"
                step="0.05"
              />
            </div>

            <!-- Clear Color -->
            <div class="flex items-center gap-2">
              <label
                class="text-[10px] text-(--text-muted) w-20 text-right shrink-0"
                >Clear Color</label
              >
              <div
                class="flex items-center gap-2 bg-[var(--bg-input)] border border-[var(--border-light)] rounded p-1 w-full h-6"
              >
                <input
                  type="color"
                  :value="colorToHex(config.clearColor || [0,0,0])"
                  @input="const rgb = hexToRgb($event.target.value); config.clearColor = [rgb.r, rgb.g, rgb.b, 1]; hotUpdate()"
                  class="w-8 h-full border-none p-0 cursor-pointer bg-transparent"
                />
                <span
                  class="text-[10px] font-mono text-[var(--text-dim)] flex-1 text-right pr-1"
                  x-text="colorToHex(config.clearColor || [0,0,0])"></span>
              </div>
            </div>
          </div>

          <!-- Fog -->
          <div class="px-2 py-2 border-t border-[var(--border-light)] mt-1">
            <div class="flex items-center justify-between mb-2">
              <span
                class="text-[10px] font-bold text-[var(--text-dim)] uppercase tracking-wider"
                >Fog</span
              >
              <input
                type="checkbox"
                x-model="config.fogEnabled"
                @change="hotUpdate"
                class="accent-[var(--accent-primary)]"
              />
            </div>

            <div x-show="config.fogEnabled" class="space-y-1">
              <!-- Fog Color -->
              <div class="flex items-center gap-2">
                <label
                  class="text-[10px] text-(--text-muted) w-20 text-right shrink-0"
                  >Color</label
                >
                <div
                  class="flex items-center gap-2 bg-[var(--bg-input)] border border-[var(--border-light)] rounded p-1 w-full h-6"
                >
                  <input
                    type="color"
                    :value="colorToHex(config.fogColor || [0.5,0.5,0.5])"
                    @input="const rgb = hexToRgb($event.target.value); config.fogColor = [rgb.r, rgb.g, rgb.b]; hotUpdate()"
                    class="w-8 h-full border-none p-0 cursor-pointer bg-transparent"
                  />
                  <span
                    class="text-[10px] font-mono text-[var(--text-dim)] flex-1 text-right pr-1"
                    x-text="colorToHex(config.fogColor || [0.5,0.5,0.5])"
                  ></span>
                </div>
              </div>

              <!-- Fog Density -->
              <div class="flex items-center gap-2">
                <label
                  class="text-[10px] text-(--text-muted) w-20 text-right shrink-0"
                  >Density</label
                >
                <input
                  type="number"
                  x-model.number="config.fogDensity"
                  @input="hotUpdate"
                  class="blender-input w-full"
                  step="0.001"
                />
              </div>
            </div>
          </div>
        </div>

        <div class="prop-group mt-1">
          <div class="prop-group-header">POST PROCESS</div>
          <div class="p-2 space-y-1">
            <template
              x-for="setting in ['grain', 'vignette', 'chromaticAberration', 'contrast', 'exposure']"
            >
              <div class="flex items-center gap-2">
                <label
                  class="text-[10px] text-(--text-muted) w-20 text-right shrink-0 truncate"
                  x-text="camelToTitle(setting)"></label>
                <input
                  type="number"
                  :value="config.pipeline?.[setting] ?? 0"
                  @input="if(!config.pipeline) config.pipeline = {grain:0,vignette:0,vignetteWeight:0,chromaticAberration:0,contrast:1,exposure:1}; config.pipeline[setting] = parseFloat($event.target.value); hotUpdate()"
                  class="blender-input w-full text-center"
                  :step="getPipelineRange(setting).step"
                />
              </div>
            </template>
          </div>
        </div>
      </div>
    </template>

    <!-- Entity Selection -->
    <template
      x-if="selectedEntityIdx !== -1 && config.entities[selectedEntityIdx]"
    >
      <div>
        <!-- Entity Header Panel -->
        <div
          class="p-4 bg-[var(--bg-header)] border-b border-[var(--border-field)] mb-2 flex flex-col gap-2"
        >
          <div class="flex items-start gap-4">
            <div
              class="w-12 h-12 bg-[var(--bg-panel)] rounded-md flex items-center justify-center text-3xl border border-[var(--border-field)] shrink-0 shadow-sm"
            >
              <span x-text="getIcon(config.entities[selectedEntityIdx].type)"
              ></span>
            </div>
            <div class="flex-1 min-w-0 flex flex-col justify-center h-12">
              <input
                type="text"
                x-model="config.entities[selectedEntityIdx].name"
                @input="markDirty()"
                placeholder="Entity Name"
                class="w-full bg-transparent text-[15px] font-bold text-[var(--text-main)] placeholder-[var(--text-muted)] border-b border-transparent hover:border-[var(--border-field)] focus:border-[var(--accent-primary)] outline-none transition-all px-0 py-1"
              />
              <div
                class="text-[10px] text-[var(--accent-primary)] uppercase tracking-widest font-bold mt-1"
                x-text="config.entities[selectedEntityIdx].type"
              >
              </div>
            </div>
          </div>
        </div>

        <!-- Transform Group -->
        <div class="prop-group">
          <div class="prop-group-header">TRANSFORM</div>

          <div class="space-y-1 p-2">
            <!-- Position -->
            <div class="flex items-center gap-2">
              <label
                class="text-[10px] text-(--text-muted) w-14 text-right shrink-0"
                >Location</label
              >
              <div class="grid grid-cols-3 gap-1 w-full">
                <div class="relative group">
                  <div
                    class="absolute left-1 top-1/2 -translate-y-1/2 text-[8px] font-bold text-red-500 pointer-events-none select-none"
                  >
                    X
                  </div>
                  <input
                    type="number"
                    step="0.1"
                    x-model.number="config.entities[selectedEntityIdx].position[0]"
                    @input="updateTransformFromUI"
                    class="blender-input w-full pl-3 text-center"
                  />
                </div>
                <div class="relative group">
                  <div
                    class="absolute left-1 top-1/2 -translate-y-1/2 text-[8px] font-bold text-green-500 pointer-events-none select-none"
                  >
                    Y
                  </div>
                  <input
                    type="number"
                    step="0.1"
                    x-model.number="config.entities[selectedEntityIdx].position[1]"
                    @input="updateTransformFromUI"
                    class="blender-input w-full pl-3 text-center"
                  />
                </div>
                <div class="relative group">
                  <div
                    class="absolute left-1 top-1/2 -translate-y-1/2 text-[8px] font-bold text-blue-500 pointer-events-none select-none"
                  >
                    Z
                  </div>
                  <input
                    type="number"
                    step="0.1"
                    x-model.number="config.entities[selectedEntityIdx].position[2]"
                    @input="updateTransformFromUI"
                    class="blender-input w-full pl-3 text-center"
                  />
                </div>
              </div>
            </div>

            <!-- Rotation -->
            <div class="flex items-center gap-2">
              <label
                class="text-[10px] text-(--text-muted) w-14 text-right shrink-0"
                >Rotation</label
              >
              <div class="grid grid-cols-3 gap-1 w-full">
                <!-- X -->
                <div class="relative group" x-data>
                  <div
                    class="absolute left-1 top-1/2 -translate-y-1/2 text-[8px] font-bold text-red-500 pointer-events-none select-none"
                  >
                    X
                  </div>
                  <input
                    type="number"
                    step="0.1"
                    :value="config.entities[selectedEntityIdx].rotation ? config.entities[selectedEntityIdx].rotation[0] : 0"
                    @input="if(!config.entities[selectedEntityIdx].rotation) config.entities[selectedEntityIdx].rotation = [0,0,0]; config.entities[selectedEntityIdx].rotation[0] = parseFloat($event.target.value); updateTransformFromUI()"
                    class="blender-input w-full pl-3 text-center"
                  />
                </div>
                <!-- Y -->
                <div class="relative group" x-data>
                  <div
                    class="absolute left-1 top-1/2 -translate-y-1/2 text-[8px] font-bold text-green-500 pointer-events-none select-none"
                  >
                    Y
                  </div>
                  <input
                    type="number"
                    step="0.1"
                    :value="config.entities[selectedEntityIdx].rotation ? config.entities[selectedEntityIdx].rotation[1] : 0"
                    @input="if(!config.entities[selectedEntityIdx].rotation) config.entities[selectedEntityIdx].rotation = [0,0,0]; config.entities[selectedEntityIdx].rotation[1] = parseFloat($event.target.value); updateTransformFromUI()"
                    class="blender-input w-full pl-3 text-center"
                  />
                </div>
                <!-- Z -->
                <div class="relative group" x-data>
                  <div
                    class="absolute left-1 top-1/2 -translate-y-1/2 text-[8px] font-bold text-blue-500 pointer-events-none select-none"
                  >
                    Z
                  </div>
                  <input
                    type="number"
                    step="0.1"
                    :value="config.entities[selectedEntityIdx].rotation ? config.entities[selectedEntityIdx].rotation[2] : 0"
                    @input="if(!config.entities[selectedEntityIdx].rotation) config.entities[selectedEntityIdx].rotation = [0,0,0]; config.entities[selectedEntityIdx].rotation[2] = parseFloat($event.target.value); updateTransformFromUI()"
                    class="blender-input w-full pl-3 text-center"
                  />
                </div>
              </div>
            </div>

            <!-- Scale (uniform for NPCs, per-axis for props) -->
            <div class="flex items-center gap-2">
              <label
                class="text-[10px] text-(--text-muted) w-14 text-right shrink-0"
                >Scale</label
              >
              <!-- Uniform scale for NPCs -->
              <template
                x-if="config.entities[selectedEntityIdx].type !== 'prop'"
              >
                <div class="w-full">
                  <input
                    type="number"
                    step="0.1"
                    class="blender-input w-full text-center"
                    :value="getEntityScale(config.entities[selectedEntityIdx])"
                    @input="setEntityScale(config.entities[selectedEntityIdx], parseFloat($event.target.value))"
                  />
                </div>
              </template>
              <!-- Per-axis scale for props -->
              <template
                x-if="config.entities[selectedEntityIdx].type === 'prop'"
              >
                <div class="grid grid-cols-3 gap-1 w-full">
                  <div class="relative group">
                    <div
                      class="absolute left-1 top-1/2 -translate-y-1/2 text-[8px] font-bold text-red-500 pointer-events-none select-none"
                    >
                      X
                    </div>
                    <input
                      type="number"
                      step="0.1"
                      :value="config.entities[selectedEntityIdx].scaling ? config.entities[selectedEntityIdx].scaling[0] : 1"
                      @input="if(!config.entities[selectedEntityIdx].scaling) config.entities[selectedEntityIdx].scaling = [1,1,1]; config.entities[selectedEntityIdx].scaling[0] = parseFloat($event.target.value); updateTransformFromUI()"
                      class="blender-input w-full pl-3 text-center"
                    />
                  </div>
                  <div class="relative group">
                    <div
                      class="absolute left-1 top-1/2 -translate-y-1/2 text-[8px] font-bold text-green-500 pointer-events-none select-none"
                    >
                      Y
                    </div>
                    <input
                      type="number"
                      step="0.1"
                      :value="config.entities[selectedEntityIdx].scaling ? config.entities[selectedEntityIdx].scaling[1] : 1"
                      @input="if(!config.entities[selectedEntityIdx].scaling) config.entities[selectedEntityIdx].scaling = [1,1,1]; config.entities[selectedEntityIdx].scaling[1] = parseFloat($event.target.value); updateTransformFromUI()"
                      class="blender-input w-full pl-3 text-center"
                    />
                  </div>
                  <div class="relative group">
                    <div
                      class="absolute left-1 top-1/2 -translate-y-1/2 text-[8px] font-bold text-blue-500 pointer-events-none select-none"
                    >
                      Z
                    </div>
                    <input
                      type="number"
                      step="0.1"
                      :value="config.entities[selectedEntityIdx].scaling ? config.entities[selectedEntityIdx].scaling[2] : 1"
                      @input="if(!config.entities[selectedEntityIdx].scaling) config.entities[selectedEntityIdx].scaling = [1,1,1]; config.entities[selectedEntityIdx].scaling[2] = parseFloat($event.target.value); updateTransformFromUI()"
                      class="blender-input w-full pl-3 text-center"
                    />
                  </div>
                </div>
              </template>
            </div>
          </div>
        </div>

        <div class="prop-group mt-1">
          <div class="prop-group-header">LOGIC & DATA</div>
          <div class="p-2 space-y-1">
            <div class="flex items-center gap-2">
              <label
                class="text-[10px] text-(--text-muted) w-14 text-right shrink-0"
                >Type</label
              >
              <select
                x-model="config.entities[selectedEntityIdx].type"
                @change="forceUpdateEntity(selectedEntityIdx)"
                class="blender-input w-full"
              >
                <option value="npc">NPC</option>
                <option value="portal">Portal</option>
                <option value="prop">Prop</option>
              </select>
            </div>

            <!-- NPC Model -->
            <div
              x-show="config.entities[selectedEntityIdx].type === 'npc'"
              class="flex gap-2 items-center"
            >
              <label
                class="text-[10px] text-(--text-muted) w-14 text-right shrink-0"
                >Model</label
              >
              <div class="flex-1 flex gap-1">
                <input
                  type="text"
                  :value="config.entities[selectedEntityIdx].asset || config.entities[selectedEntityIdx].entity || ''"
                  @input="config.entities[selectedEntityIdx].asset = $event.target.value; delete config.entities[selectedEntityIdx].entity"
                  class="blender-input w-full truncate"
                  readonly
                />
                <button
                  @click="openAssetBrowser(selectedEntityIdx, 'entity')"
                  class="px-2 bg-[var(--bg-input)] hover:bg-[var(--bg-input-hover)] border border-[var(--border-light)] rounded select-none text-[10px]"
                  title="Select Model">üìÇ</button
                >
              </div>
            </div>

            <!-- Prop Asset -->
            <div
              x-show="config.entities[selectedEntityIdx].type === 'prop'"
              class="flex gap-2 items-center"
            >
              <label
                class="text-[10px] text-(--text-muted) w-14 text-right shrink-0"
                >Asset</label
              >
              <div class="flex-1 flex gap-1">
                <input
                  type="text"
                  x-model="config.entities[selectedEntityIdx].asset"
                  class="blender-input w-full truncate"
                />
                <button
                  @click="openAssetBrowser(selectedEntityIdx, 'asset')"
                  class="px-2 bg-[var(--bg-input)] hover:bg-[var(--bg-input-hover)] border border-[var(--border-light)] rounded select-none text-[10px]"
                  >üìÇ</button
                >
              </div>
            </div>

            <!-- Portal Target -->
            <div
              x-show="config.entities[selectedEntityIdx].type === 'portal'"
              class="flex gap-2 items-center"
            >
              <label
                class="text-[10px] text-(--text-muted) w-14 text-right shrink-0"
                >Target</label
              >
              <select
                x-model="config.entities[selectedEntityIdx].targetLevel"
                @change="markDirty()"
                class="blender-input flex-1"
              >
                <option value="">-- Select Level --</option>
                <template x-for="level in levelList" :key="level.id">
                  <option :value="level.id" x-text="level.name"></option>
                </template>
              </select>
            </div>

            <!-- NPC Animations -->
            <div
              x-show="config.entities[selectedEntityIdx].type === 'npc'"
              class="pt-2 mt-1 border-t border-[var(--border-light)]"
            >
              <div
                class="text-[10px] font-bold text-[var(--text-dim)] uppercase tracking-wider mb-1 px-2"
              >
                Animations
              </div>
              <div class="space-y-1">
                <!-- Idle Animation -->
                <div class="flex items-center gap-2">
                  <label
                    class="text-[10px] text-(--text-muted) w-14 text-right shrink-0"
                    >Idle</label
                  >
                  <div class="flex-1 flex gap-1">
                    <select
                      :value="config.entities[selectedEntityIdx]?.animations?.idle || ''"
                      @change="if(!config.entities[selectedEntityIdx].animations) config.entities[selectedEntityIdx].animations = {idle:'',interact:''}; config.entities[selectedEntityIdx].animations.idle = $event.target.value; markDirty()"
                      class="blender-input w-full text-[10px]"
                    >
                      <option value="">-- Select --</option>
                      <template x-for="anim in currentEntityAnims" :key="anim">
                        <option :value="anim" x-text="anim"></option>
                      </template>
                    </select>
                    <button
                      @click="if(config.entities[selectedEntityIdx]?.animations) config.entities[selectedEntityIdx].animations.idle = '';"
                      class="px-1.5 text-(--text-muted) hover:text-red-400 transition-colors text-[10px] bg-[var(--bg-input)] border border-[var(--border-light)] rounded"
                      title="Clear">√ó</button
                    >
                    <button
                      @click="previewAnimation(selectedEntityIdx, config.entities[selectedEntityIdx]?.animations?.idle)"
                      class="px-1.5 text-[var(--accent-primary)] hover:text-white transition-colors text-[10px] bg-[var(--bg-input)] border border-[var(--border-light)] rounded"
                      title="Play Idle">‚ñ∂</button
                    >
                  </div>
                </div>
                <!-- Interact Animation -->
                <div class="flex items-center gap-2">
                  <label
                    class="text-[10px] text-(--text-muted) w-14 text-right shrink-0"
                    >Interact</label
                  >
                  <div class="flex-1 flex gap-1">
                    <select
                      :value="config.entities[selectedEntityIdx]?.animations?.interact || ''"
                      @change="if(!config.entities[selectedEntityIdx].animations) config.entities[selectedEntityIdx].animations = {idle:'',interact:''}; config.entities[selectedEntityIdx].animations.interact = $event.target.value; markDirty()"
                      class="blender-input w-full text-[10px]"
                    >
                      <option value="">-- Select --</option>
                      <template x-for="anim in currentEntityAnims" :key="anim">
                        <option :value="anim" x-text="anim"></option>
                      </template>
                    </select>
                    <button
                      @click="if(config.entities[selectedEntityIdx]?.animations) config.entities[selectedEntityIdx].animations.interact = '';"
                      class="px-1.5 text-(--text-muted) hover:text-red-400 transition-colors text-[10px] bg-[var(--bg-input)] border border-[var(--border-light)] rounded"
                      title="Clear">√ó</button
                    >
                    <button
                      @click="previewAnimation(selectedEntityIdx, config.entities[selectedEntityIdx]?.animations?.interact)"
                      class="px-1.5 text-[var(--accent-primary)] hover:text-white transition-colors text-[10px] bg-[var(--bg-input)] border border-[var(--border-light)] rounded"
                      title="Play Interact">‚ñ∂</button
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- NPC Interaction Sound -->
        <div
          x-show="config.entities[selectedEntityIdx].type === 'npc'"
          class="flex items-center gap-2 mt-2"
        >
          <label
            class="text-[10px] text-[var(--text-muted)] w-14 text-right shrink-0"
            >Sound</label
          >
          <div class="flex-1 flex gap-1">
            <input
              type="text"
              x-model="config.entities[selectedEntityIdx].interactionSound"
              @change="markDirty()"
              placeholder="sound_id"
              class="bg-[var(--bg-input)] border border-[var(--border-light)] rounded px-2 py-1 text-[10px] w-full text-[var(--text-main)] outline-none focus:border-[var(--accent-primary)]"
            />
            <button
              @click="openAssetBrowser(selectedEntityIdx, 'sound')"
              class="px-2 bg-[var(--bg-input)] hover:bg-[var(--bg-input-hover)] border border-[var(--border-light)] rounded text-[10px]"
              title="Select Sound">üéµ</button
            >
          </div>
        </div>
      </div>
    </template>

    <!-- NPC Dialogue Editor -->

    <template
      x-if="selectedEntityIdx !== -1 && config.entities[selectedEntityIdx] && ['npc', 'prop'].includes(config.entities[selectedEntityIdx].type)"
    >
      <div class="space-y-2 pt-2 border-t border-[var(--border-light)] px-2">
        <!-- Script Editor -->
        <template x-if="config.entities[selectedEntityIdx].type === 'npc'">
          <div class="mb-2">
            <button
              @click="openScriptEditor(selectedEntityIdx)"
              class="w-full py-2 text-green-500 border-green-500/30 font-bold text-[10px] rounded transition-colors flex items-center justify-center gap-2 uppercase tracking-wide border hover:bg-green-500/10"
            >
              <span>üìú</span>
              <span>Edit Script</span>
            </button>
          </div>
        </template>
      </div>
    </template>
  </div>

  <template
    x-if="selectedEntityIdx !== -1 && config.entities[selectedEntityIdx] && config.entities[selectedEntityIdx].type === 'prop'"
  >
    <div class="prop-group mt-1">
      <div class="prop-group-header flex justify-between">
        <span>PHYSICS</span>
        <input
          type="checkbox"
          :checked="config.entities[selectedEntityIdx].physics?.enabled ?? false"
          @change="if(!$el.checked) { delete config.entities[selectedEntityIdx].physics; } else { config.entities[selectedEntityIdx].physics = { enabled: true, mass: 0, impostor: 'box' }; } reloadLevelPromise()"
          class="accent-[var(--accent-primary)]"
        />
      </div>

      <template x-if="config.entities[selectedEntityIdx].physics?.enabled">
        <div class="space-y-1 p-2">
          <div class="flex items-center gap-2">
            <label
              class="text-[10px] text-(--text-muted) w-20 text-right shrink-0"
              >Mass (kg)</label
            >
            <input
              type="number"
              x-model.number="config.entities[selectedEntityIdx].physics.mass"
              @change="reloadLevelPromise"
              class="blender-input w-20"
            />
          </div>
          <div class="flex items-center gap-2">
            <label
              class="text-[10px] text-(--text-muted) w-20 text-right shrink-0"
              >Collider</label
            >
            <select
              x-model="config.entities[selectedEntityIdx].physics.impostor"
              @change="reloadLevelPromise"
              class="blender-input w-full"
            >
              <option value="box">Box</option>
              <option value="sphere">Sphere</option>
              <option value="mesh">Mesh</option>
              <option value="capsule">Capsule</option>
            </select>
          </div>
        </div>
      </template>
      <template x-if="!config.entities[selectedEntityIdx].physics?.enabled">
        <div class="text-[var(--text-dim)] text-[10px] italic text-center py-2">
          Physics Disabled
        </div>
      </template>
    </div>
  </template>
</aside>
